<!DOCTYPE html>
<html lang="en">
<head>
    <title>Network</title>
    <script
        type="text/javascript"
        src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
    <style type="text/css">
        .container {
        position: relative;
        overflow: hidden;
        width: 100%;
        padding-top: 27%;
        z-index: 1;
        }
        .network {
        position:  absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="network" class="network"></div>
    </div>
    <script
        type="text/javascript"
        src="./janestreet.js"
    ></script>
    <script type="text/javascript">
        // Retrieve URL parameters
        const P = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        })
        // P.n          Count of nodes to display
        // P.labels     ['position', 'label', 'height', 'reluctant_inv']
        // P.arrows     ['none', 'up', 'down', 'both', 'to3']
        N = parseInt(P.n)
        WIDTH = document.getElementById("network").clientWidth

        // Create nodes
        var nodes = new vis.DataSet([])
        for (let i = 0; i < N; ++i) {
            let diam = WIDTH/N/2.2
            nodes.add([
                {
                    id: '' + i,
                    shape: 'circle',
                    widthConstraint: diam,
                    color: is_black(i) ? hsl_to_col(0, 0., 50.) : hsl_to_col(0, 0., 90.),
                    font: {
                        size: WIDTH/4/N,
                        color: is_white(i) ? hsl_to_col(0, 0., 50.) : hsl_to_col(0, 0., 90.),
                    },
                    label: i == N-1 ? '..' : f_label(i, P.labels),
                    x: diam/2 + i*(WIDTH - diam)/N,
                    y: 0,
                }
            ])
        }

        // Create edges
        var edges = new vis.DataSet([])
        if (P.arrows == 'none') {
            for (let i = 0; i < N - 1; ++i) {
                edges.add([
                    {
                        id: '' + i,
                        from: i,
                        to: i + 1,
                        color: hsl_to_col(0, 0., 50.),
                        smooth: false,
                        width: 1,
                    },
                ])
            }
        } else if (P.arrows == 'to3') {
            for (let i of [1, 2, 4, 7, 3]) {
                edges.add([
                    {
                        id: '' + i,
                        from: back(i),
                        to: i,
                        arrows: {to: {enabled: true, scaleFactor: 0.2}},
                        label: '' + height(i),
                        font: {
                            size: WIDTH/8/N,
                            //align: 'middle',
                            vadjust: -WIDTH/8/N,
                        },
                        color: hsl_to_col(8*back(i), 80., 50.),
                        smooth: {enabled: true, type: 'curvedCW'},
                        width: 2,
                    },
                ])
            }
        } else {
            if (P.arrows == 'up' || P.arrows == 'both') {
                for (let i = 0; i < N - 1; ++i) {
                    edges.add([
                        {
                            id: 'u' + i,
                            from: i,
                            to: up(i),
                            arrows: {to: {enabled: true, scaleFactor: 0.2}},
                            color: hsl_to_col(8*i, 80., 50.),
                            smooth: {enabled: true, type: 'curvedCW'},
                            width: 2,
                        },
                    ])
                }
            }
            if (P.arrows == 'down' || P.arrows == 'both') {
                for (let i = 1; i < N - 1; ++i) {
                    edges.add([
                        {
                            id: 'd' + i,
                            from: i,
                            to: down(i),
                            arrows: {to: {enabled: true, scaleFactor: 0.2}},
                            color: hsl_to_col(8*i, 80., 50.),
                            smooth: {enabled: true, type: 'curvedCW'},
                            width: 2,
                        },
                    ])
                }
            }
        }

        // Create a network
        var container = document.getElementById("network")
        var data = {
            nodes: nodes,
            edges: edges,
        }
        var options = {
        // https://github.com/visjs/vis-network/issues/671
        interaction: {
            dragNodes: P.interactive == 'yes' ? true: false,
            dragView: P.interactive == 'yes' ? true: false,
            keyboard: false,
            zoomView: P.interactive == 'yes' ? true: false,
        },
        physics: false,
      }
      var network = new vis.Network(container, data, options);
      //network.fit()
    </script>
  </body>
</html>